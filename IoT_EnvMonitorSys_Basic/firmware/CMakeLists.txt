# IoT_EnvMonitorSys_Basic/firmware/CMakeLists.txt
cmake_minimum_required(VERSION 3.10)

# é¡¹ç›®åç§°å’Œè¯­è¨€
project(IoT_EnvMonitor C)

# è®¾ç½®Cæ ‡å‡†
set(CMAKE_C_STANDARD 11)
set(CMAKE_C_STANDARD_REQUIRED ON)

# ç¼–è¯‘é€‰é¡¹
if(MSVC)
    add_compile_options(/W3)
else()
    add_compile_options(-Wall -Wextra -g)
endif()

# åŒ…å«å¤´æ–‡ä»¶ç›®å½•
include_directories(${CMAKE_CURRENT_SOURCE_DIR}/include)

# ğŸ†• åªè®¾ç½®è¿è¡Œæ—¶å’Œåº“è¾“å‡ºç›®å½•ï¼Œåˆ é™¤å½’æ¡£ç›®å½•
# set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/lib)
# set(CMAKE_LIBRARY_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/lib)
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/build/bin)
set(CMAKE_LIBRARY_OUTPUT_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/build/lib)

# å¯æ‰§è¡Œæ–‡ä»¶ - ä¸»è®¾å¤‡ç¨‹åº
add_executable(env_monitor
    src/main.c
    src/sensor_emulator.c  
    src/mqtt_client.c
)

# åŠ¨æ€åº“ - ä¾›Pythonæµ‹è¯•è°ƒç”¨
add_library(env_monitor_shared SHARED
    src/sensor_emulator.c
    src/mqtt_client.c
)

# è®¾ç½®åº“çš„å±æ€§
set_target_properties(env_monitor_shared PROPERTIES
    OUTPUT_NAME "env_monitor"
    VERSION 1.0.0
    SOVERSION 1
)

# è®¾ç½®å¯æ‰§è¡Œæ–‡ä»¶è¾“å‡ºåç§°ï¼Œé¿å…ä¸åº“æ–‡ä»¶å†²çª
set_target_properties(env_monitor PROPERTIES
    OUTPUT_NAME "env_monitor_app"
)

message(STATUS "=== IoT Environment Monitor CMakeé…ç½® ===")
message(STATUS "é¡¹ç›®åç§°: ${PROJECT_NAME}")
message(STATUS "è¾“å‡ºç›®å½•: ${CMAKE_BINARY_DIR}/lib")
message(STATUS "ç”Ÿæˆç›®æ ‡:")
message(STATUS "  env_monitor_app     - è®¾å¤‡å¯æ‰§è¡Œç¨‹åº")
message(STATUS "  env_monitor         - è®¾å¤‡åŠ¨æ€åº“")